# 🚀 现在就开始部署 - 手把手操作手册

## 📋 当前状态
- ✅ 配置文件已生成完毕
- ✅ 服务器信息已确认
- ✅ 域名已提供
- 🎯 **现在需要：将配置文件上传到服务器并执行部署**

---

## 🎯 第一步：打开终端连接服务器

### Windows 用户：
1. 按 `Win + R`，输入 `cmd`，回车
2. 或者使用 PowerShell、Git Bash、WSL

### Mac/Linux 用户：
1. 打开终端应用

### 连接服务器：
```bash
ssh root@206.238.115.75
```

**当提示输入密码时，输入：** `B678*fdWeasQ`

> 💡 **注意**：输入密码时屏幕不会显示任何字符，这是正常的，直接输入完按回车即可

---

## 🎯 第二步：在服务器上创建工作目录

连接成功后，在服务器上执行：

```bash
# 创建部署目录
mkdir -p /opt/rocketchat
cd /opt/rocketchat

# 确认当前位置
pwd
```

应该显示：`/opt/rocketchat`

---

## 🎯 第三步：上传配置文件到服务器

### 方法一：使用 scp 命令（推荐）

**重新打开一个新的终端窗口**（保持服务器连接不要断开），在你的本地电脑上执行：

```bash
# 进入配置文件目录
cd /home/admin888/code/Rocket.Chat

# 上传所有配置文件
scp docker-compose.prod.yml root@206.238.115.75:/opt/rocketchat/
scp mongo-init.js root@206.238.115.75:/opt/rocketchat/
scp setup-ssl.sh root@206.238.115.75:/opt/rocketchat/
scp deploy.sh root@206.238.115.75:/opt/rocketchat/
scp -r nginx root@206.238.115.75:/opt/rocketchat/
```

每次都会要求输入密码：`B678*fdWeasQ`

### 方法二：使用文件传输工具

如果你有 FileZilla、WinSCP 等工具：
- 主机：206.238.115.75
- 用户名：root
- 密码：B678*fdWeasQ
- 端口：22

将以下文件上传到 `/opt/rocketchat/` 目录：
- `docker-compose.prod.yml`
- `mongo-init.js`
- `setup-ssl.sh`
- `deploy.sh`
- `nginx/` 整个文件夹

---

## 🎯 第四步：在服务器上验证文件

回到服务器终端，执行：

```bash
# 查看上传的文件
ls -la /opt/rocketchat/
```

应该看到：
```
drwxr-xr-x 3 root root 4096 ... .
drwxr-xr-x 3 root root 4096 ... ..
-rw-r--r-- 1 root root 3XXX ... docker-compose.prod.yml
-rw-r--r-- 1 root root  XXX ... mongo-init.js
-rw-r--r-- 1 root root 2XXX ... setup-ssl.sh
-rw-r--r-- 1 root root 5XXX ... deploy.sh
drwxr-xr-x 2 root root 4096 ... nginx
```

---

## 🎯 第五步：给脚本添加执行权限

```bash
chmod +x /opt/rocketchat/setup-ssl.sh
chmod +x /opt/rocketchat/deploy.sh
```

---

## 🎯 第六步：执行一键部署脚本

```bash
cd /opt/rocketchat
./deploy.sh
```

### 🔄 部署过程中会发生什么：

1. **系统检查** - 检查操作系统
2. **安装依赖** - 安装 Docker、Docker Compose 等
3. **配置防火墙** - 开放必要端口
4. **域名检查** - 验证域名是否指向服务器
5. **启动服务** - 启动 MongoDB 和 Rocket.Chat
6. **SSL 配置** - 自动申请 Let's Encrypt 证书
7. **完整启动** - 启动所有服务
8. **健康检查** - 验证服务是否正常

### ⏱️ 预计时间：
- 首次部署：10-15 分钟
- 主要时间花在下载 Docker 镜像上

---

## 🎯 第七步：验证部署结果

### 检查服务状态：
```bash
docker-compose -f docker-compose.prod.yml ps
```

应该看到所有服务都是 `Up` 状态。

### 测试网站访问：
```bash
curl -I https://im.lc2023.com
```

应该返回 `HTTP/2 200` 状态。

---

## 🎯 第八步：访问 Rocket.Chat

1. **打开浏览器**
2. **访问**：https://im.lc2023.com
3. **登录信息**：
   - 用户名：`admin`
   - 密码：`ChangeThisPassword123!`
   - 邮箱：`admin@lc2023.com`

---

## ⚠️ 如果遇到问题

### 问题1：无法连接服务器
```bash
# 检查网络连接
ping 206.238.115.75

# 检查 SSH 服务
telnet 206.238.115.75 22
```

### 问题2：域名无法访问
```bash
# 检查域名解析
dig +short im.lc2023.com
# 应该返回：206.238.115.75
```

### 问题3：服务启动失败
```bash
# 查看详细日志
docker-compose -f docker-compose.prod.yml logs -f

# 重启服务
docker-compose -f docker-compose.prod.yml restart
```

### 问题4：SSL 证书申请失败
```bash
# 手动申请证书
./setup-ssl.sh

# 检查域名 DNS
nslookup im.lc2023.com
```

---

## 🎉 部署成功后的重要事项

### 1. 立即修改密码
- 登录 Rocket.Chat 管理界面
- 修改管理员密码
- 修改数据库密码（在 docker-compose.prod.yml 中）

### 2. 配置邮件服务
- 进入 管理 > 邮件 > SMTP
- 配置你的邮件服务器

### 3. 设置备份
```bash
# 创建备份脚本（已包含在部署脚本中）
crontab -l
```

---

## 📞 需要帮助？

如果在任何步骤遇到问题：

1. **复制错误信息**
2. **告诉我你在哪一步遇到问题**
3. **提供具体的错误输出**

我会帮你解决！

---

## 🚀 开始行动吧！

**现在就开始第一步：连接服务器**

```bash
ssh root@206.238.115.75
```

输入密码：`B678*fdWeasQ`

然后按照上面的步骤一步步执行即可！