# Ê≠•È™§5ÔºöÁîü‰∫ßÈÉ®ÁΩ≤ËØ¶ÁªÜÊìç‰ΩúÊåáÂçó

## üìã Ê¶ÇËø∞

Êú¨ÊñáÊ°£Â∞ÜËØ¶ÁªÜÊåáÂØºÊÇ®Â¶Ç‰ΩïÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠ÈÉ®ÁΩ≤Â∑≤ÊûÑÂª∫Â•ΩÁöÑ Rocket.Chat Docker ÈïúÂÉè„ÄÇÊàë‰ª¨Â∞Ü‰ΩøÁî® Docker Compose ËøõË°åÈÉ®ÁΩ≤ÔºåÂåÖÂê´ÂÆåÊï¥ÁöÑÊï∞ÊçÆÂ∫ì„ÄÅÂèçÂêë‰ª£ÁêÜ„ÄÅSSL ËØÅ‰π¶Á≠âÈÖçÁΩÆ„ÄÇ

## üéØ ÈÉ®ÁΩ≤ÁõÆÊ†á

- ÈÉ®ÁΩ≤ÂÆöÂà∂ÂåñÁöÑ Rocket.Chat Â∫îÁî®ÔºàÂåÖÂê´ HT.Chat ÂìÅÁâåÔºâ
- ÈÖçÁΩÆ MongoDB Êï∞ÊçÆÂ∫ì
- ËÆæÁΩÆ Nginx ÂèçÂêë‰ª£ÁêÜ
- ÈÖçÁΩÆ SSL ËØÅ‰π¶ÔºàLet's EncryptÔºâ
- ÂÆûÁé∞Ëá™Âä®Â§á‰ªΩÂíåÁõëÊéß

## üìã ÂâçÁΩÆË¶ÅÊ±Ç

### ÊúçÂä°Âô®Ë¶ÅÊ±Ç
- **Êìç‰ΩúÁ≥ªÁªü**: Ubuntu 20.04+ / CentOS 8+ / Debian 11+
- **CPU**: ÊúÄ‰Ωé 2 Ê†∏ÔºåÊé®Ëçê 4 Ê†∏
- **ÂÜÖÂ≠ò**: ÊúÄ‰Ωé 4GBÔºåÊé®Ëçê 8GB
- **Â≠òÂÇ®**: ÊúÄ‰Ωé 50GBÔºåÊé®Ëçê 100GB SSD
- **ÁΩëÁªú**: ÂÖ¨ÁΩë IP Âú∞ÂùÄ

### ÂüüÂêçË¶ÅÊ±Ç
- Â∑≤Ê≥®ÂÜåÁöÑÂüüÂêçÔºàÂ¶ÇÔºöchat.yourcompany.comÔºâ
- DNS ËÆ∞ÂΩïÂ∑≤ÊåáÂêëÊúçÂä°Âô® IP

## üöÄ Á¨¨‰∏ÄÊ≠•ÔºöÊúçÂä°Âô®ÁéØÂ¢ÉÂáÜÂ§á

### 1.1 ËøûÊé•Âà∞ÊúçÂä°Âô®

```bash
# ‰ΩøÁî® SSH ËøûÊé•Âà∞ÊÇ®ÁöÑÊúçÂä°Âô®
ssh root@your-server-ip

# Êàñ‰ΩøÁî®ÊôÆÈÄöÁî®Êà∑ÔºàÊé®ËçêÔºâ
ssh username@your-server-ip
```

### 1.2 Êõ¥Êñ∞Á≥ªÁªü

```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y
# ÊàñËÄÖÂØπ‰∫éËæÉÊñ∞ÁâàÊú¨
sudo dnf update -y
```

### 1.3 ÂÆâË£ÖÂøÖË¶ÅÂ∑•ÂÖ∑

```bash
# Ubuntu/Debian
sudo apt install -y curl wget git unzip htop nano

# CentOS/RHEL
sudo yum install -y curl wget git unzip htop nano
```

## üê≥ Á¨¨‰∫åÊ≠•ÔºöÂÆâË£Ö Docker Âíå Docker Compose

### 2.1 ÂÆâË£Ö Docker

#### Ubuntu/Debian Á≥ªÁªüÔºö

```bash
# Âç∏ËΩΩÊóßÁâàÊú¨
sudo apt remove docker docker-engine docker.io containerd runc

# ÂÆâË£Ö‰æùËµñ
sudo apt install -y apt-transport-https ca-certificates curl gnupg lsb-release

# Ê∑ªÂä† Docker ÂÆòÊñπ GPG ÂØÜÈí•
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# Ê∑ªÂä† Docker ‰ªìÂ∫ì
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Êõ¥Êñ∞ÂåÖÁ¥¢ÂºïÂπ∂ÂÆâË£Ö Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io
```

#### CentOS/RHEL Á≥ªÁªüÔºö

```bash
# Âç∏ËΩΩÊóßÁâàÊú¨
sudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine

# ÂÆâË£Ö‰æùËµñ
sudo yum install -y yum-utils

# Ê∑ªÂä† Docker ‰ªìÂ∫ì
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# ÂÆâË£Ö Docker
sudo yum install -y docker-ce docker-ce-cli containerd.io
```

### 2.2 ÂêØÂä®Âπ∂ÂêØÁî® Docker

```bash
# ÂêØÂä® Docker ÊúçÂä°
sudo systemctl start docker

# ËÆæÁΩÆÂºÄÊú∫Ëá™ÂêØ
sudo systemctl enable docker

# È™åËØÅÂÆâË£Ö
sudo docker --version
sudo docker run hello-world
```

### 2.3 ÂÆâË£Ö Docker Compose

```bash
# ‰∏ãËΩΩ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# Ê∑ªÂä†ÊâßË°åÊùÉÈôê
sudo chmod +x /usr/local/bin/docker-compose

# È™åËØÅÂÆâË£Ö
docker-compose --version
```

### 2.4 ÈÖçÁΩÆÁî®Êà∑ÊùÉÈôêÔºàÂèØÈÄâ‰ΩÜÊé®ËçêÔºâ

```bash
# Â∞ÜÂΩìÂâçÁî®Êà∑Ê∑ªÂä†Âà∞ docker ÁªÑ
sudo usermod -aG docker $USER

# ÈáçÊñ∞ÁôªÂΩïÊàñÊâßË°å‰ª•‰∏ãÂëΩ‰ª§‰ΩøÊùÉÈôêÁîüÊïà
newgrp docker

# È™åËØÅÊó†ÈúÄ sudo Âç≥ÂèØËøêË°å docker
docker ps
```

## üìÅ Á¨¨‰∏âÊ≠•ÔºöÂàõÂª∫ÈÉ®ÁΩ≤ÁõÆÂΩïÁªìÊûÑ

### 3.1 ÂàõÂª∫È°πÁõÆÁõÆÂΩï

```bash
# ÂàõÂª∫ÈÉ®ÁΩ≤Ê†πÁõÆÂΩï
sudo mkdir -p /opt/rocketchat
cd /opt/rocketchat

# ËÆæÁΩÆÁõÆÂΩïÊùÉÈôê
sudo chown -R $USER:$USER /opt/rocketchat

# ÂàõÂª∫Â≠êÁõÆÂΩï
mkdir -p {
  data/mongodb,
  data/uploads,
  logs,
  backups,
  ssl,
  config
}
```

### 3.2 ÁõÆÂΩïÁªìÊûÑËØ¥Êòé

```
/opt/rocketchat/
‚îú‚îÄ‚îÄ docker-compose.yml          # Docker Compose ÈÖçÁΩÆÊñá‰ª∂
‚îú‚îÄ‚îÄ .env                        # ÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ mongodb/               # MongoDB Êï∞ÊçÆÁõÆÂΩï
‚îÇ   ‚îî‚îÄ‚îÄ uploads/               # Êñá‰ª∂‰∏ä‰º†ÁõÆÂΩï
‚îú‚îÄ‚îÄ logs/                      # Êó•ÂøóÁõÆÂΩï
‚îú‚îÄ‚îÄ backups/                   # Â§á‰ªΩÁõÆÂΩï
‚îú‚îÄ‚îÄ ssl/                       # SSL ËØÅ‰π¶ÁõÆÂΩï
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ nginx.conf             # Nginx ÈÖçÁΩÆÊñá‰ª∂
```

## ‚öôÔ∏è Á¨¨ÂõõÊ≠•ÔºöÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè

### 4.1 ÂàõÂª∫ .env Êñá‰ª∂

```bash
cd /opt/rocketchat
nano .env
```

### 4.2 .env Êñá‰ª∂ÂÜÖÂÆπ

```bash
# ===========================================
# Rocket.Chat Áîü‰∫ßÁéØÂ¢ÉÈÖçÁΩÆ
# ===========================================

# Âü∫Á°ÄÈÖçÁΩÆ
ROOT_URL=https://chat.yourcompany.com
PORT=3000
MONGO_URL=mongodb://mongo:27017/rocketchat?replicaSet=rs0
MONGO_OPLOG_URL=mongodb://mongo:27017/local?replicaSet=rs0

# ÁÆ°ÁêÜÂëòÈÖçÁΩÆ
ADMIN_USERNAME=admin
ADMIN_PASS=your-secure-admin-password
ADMIN_EMAIL=admin@yourcompany.com

# MongoDB ÈÖçÁΩÆ
MONGO_INITDB_ROOT_USERNAME=root
MONGO_INITDB_ROOT_PASSWORD=your-secure-mongo-password
MONGO_INITDB_DATABASE=rocketchat

# ÈÇÆ‰ª∂ÈÖçÁΩÆÔºàSMTPÔºâ
MAIL_URL=smtps://username:password@smtp.gmail.com:465
MAIL_FROM=noreply@yourcompany.com

# Êñá‰ª∂‰∏ä‰º†ÈÖçÁΩÆ
FILE_UPLOAD_STORAGE_TYPE=GridFS
FILE_UPLOAD_MAX_FILE_SIZE=104857600

# ÂÆâÂÖ®ÈÖçÁΩÆ
JWT_SECRET=your-jwt-secret-key-here
SESSION_SECRET=your-session-secret-key-here

# ÊÄßËÉΩÈÖçÁΩÆ
NODE_ENV=production
CACHE_DIR=/app/programs/server/assets/app

# SSL ÈÖçÁΩÆ
SSL_CERT_PATH=/etc/letsencrypt/live/chat.yourcompany.com/fullchain.pem
SSL_KEY_PATH=/etc/letsencrypt/live/chat.yourcompany.com/privkey.pem

# ÂüüÂêçÈÖçÁΩÆÔºàÊõøÊç¢‰∏∫ÊÇ®ÁöÑÂÆûÈôÖÂüüÂêçÔºâ
DOMAIN=chat.yourcompany.com
EMAIL=admin@yourcompany.com

# Docker ÈïúÂÉèÈÖçÁΩÆ
ROCKETCHAT_IMAGE=ghcr.io/sl1018990955/rocketchat-custom:v6.7.3-htchat-r1
```

**‚ö†Ô∏è ÈáçË¶ÅÊèêÈÜíÔºö**
- ËØ∑Â∞Ü `chat.yourcompany.com` ÊõøÊç¢‰∏∫ÊÇ®ÁöÑÂÆûÈôÖÂüüÂêç
- ËØ∑Â∞ÜÊâÄÊúâÂØÜÁ†ÅÊõøÊç¢‰∏∫Âº∫ÂØÜÁ†Å
- ËØ∑Â∞ÜÈÇÆÁÆ±Âú∞ÂùÄÊõøÊç¢‰∏∫ÊÇ®ÁöÑÂÆûÈôÖÈÇÆÁÆ±

## üê≥ Á¨¨‰∫îÊ≠•ÔºöÂàõÂª∫ Docker Compose ÈÖçÁΩÆ

### 5.1 ÂàõÂª∫ docker-compose.yml

```bash
cd /opt/rocketchat
nano docker-compose.yml
```

### 5.2 docker-compose.yml ÂÜÖÂÆπ

```yaml
version: '3.8'

services:
  # MongoDB Êï∞ÊçÆÂ∫ì
  mongo:
    image: mongo:6.0
    container_name: rocketchat-mongo
    restart: unless-stopped
    volumes:
      - ./data/mongodb:/data/db
      - ./backups:/backups
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
      MONGO_INITDB_DATABASE: ${MONGO_INITDB_DATABASE}
    command: >
      mongod 
      --oplogSize 128 
      --replSet rs0 
      --storageEngine wiredTiger
    networks:
      - rocketchat-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # MongoDB ÂâØÊú¨ÈõÜÂàùÂßãÂåñ
  mongo-init-replica:
    image: mongo:6.0
    container_name: rocketchat-mongo-init
    command: >
      bash -c
        "for i in `seq 1 30`; do
          mongo mongo/rocketchat --eval \"
            rs.initiate({
              _id: 'rs0',
              members: [ { _id: 0, host: 'localhost:27017' } ]})\"
          && s=$$? && break || s=$$?;
          echo \"Tried $$i times. Waiting 5 secs...\";
          sleep 5;
        done; (exit $$s)"
    depends_on:
      - mongo
    networks:
      - rocketchat-network

  # Rocket.Chat Â∫îÁî®
  rocketchat:
    image: ${ROCKETCHAT_IMAGE}
    container_name: rocketchat-app
    restart: unless-stopped
    volumes:
      - ./data/uploads:/app/uploads
      - ./logs:/app/logs
    environment:
      ROOT_URL: ${ROOT_URL}
      PORT: ${PORT}
      MONGO_URL: ${MONGO_URL}
      MONGO_OPLOG_URL: ${MONGO_OPLOG_URL}
      MAIL_URL: ${MAIL_URL}
      MAIL_FROM: ${MAIL_FROM}
      FILE_UPLOAD_STORAGE_TYPE: ${FILE_UPLOAD_STORAGE_TYPE}
      FILE_UPLOAD_MAX_FILE_SIZE: ${FILE_UPLOAD_MAX_FILE_SIZE}
      NODE_ENV: ${NODE_ENV}
      CACHE_DIR: ${CACHE_DIR}
    depends_on:
      - mongo
    ports:
      - "3000:3000"
    networks:
      - rocketchat-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/info"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Nginx ÂèçÂêë‰ª£ÁêÜ
  nginx:
    image: nginx:alpine
    container_name: rocketchat-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/letsencrypt:ro
      - /var/log/nginx:/var/log/nginx
    depends_on:
      - rocketchat
    networks:
      - rocketchat-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Certbot for SSL certificates
  certbot:
    image: certbot/certbot
    container_name: rocketchat-certbot
    volumes:
      - ./ssl:/etc/letsencrypt
      - ./config/certbot-webroot:/var/www/certbot
    command: certonly --webroot --webroot-path=/var/www/certbot --email ${EMAIL} --agree-tos --no-eff-email -d ${DOMAIN}
    networks:
      - rocketchat-network

networks:
  rocketchat-network:
    driver: bridge

volumes:
  mongodb-data:
  uploads-data:
```

## üåê Á¨¨ÂÖ≠Ê≠•ÔºöÈÖçÁΩÆ Nginx ÂèçÂêë‰ª£ÁêÜ

### 6.1 ÂàõÂª∫ Nginx ÈÖçÁΩÆÊñá‰ª∂

```bash
cd /opt/rocketchat
nano config/nginx.conf
```

### 6.2 nginx.conf ÂÜÖÂÆπ

```nginx
events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    # Êó•ÂøóÊ†ºÂºè
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log;
    
    # Âü∫Á°ÄÈÖçÁΩÆ
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    client_max_body_size 100M;
    
    # Gzip ÂéãÁº©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    
    # ‰∏äÊ∏∏ÊúçÂä°Âô®ÈÖçÁΩÆ
    upstream rocketchat {
        server rocketchat:3000;
    }
    
    # HTTP ÈáçÂÆöÂêëÂà∞ HTTPS
    server {
        listen 80;
        server_name chat.yourcompany.com;
        
        # Let's Encrypt È™åËØÅË∑ØÂæÑ
        location /.well-known/acme-challenge/ {
            root /var/www/certbot;
        }
        
        # ÂÖ∂‰ªñËØ∑Ê±ÇÈáçÂÆöÂêëÂà∞ HTTPS
        location / {
            return 301 https://$server_name$request_uri;
        }
    }
    
    # HTTPS ÊúçÂä°Âô®ÈÖçÁΩÆ
    server {
        listen 443 ssl http2;
        server_name chat.yourcompany.com;
        
        # SSL ËØÅ‰π¶ÈÖçÁΩÆ
        ssl_certificate /etc/letsencrypt/live/chat.yourcompany.com/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/chat.yourcompany.com/privkey.pem;
        
        # SSL ÂÆâÂÖ®ÈÖçÁΩÆ
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;
        
        # ÂÆâÂÖ®Â§¥
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
        
        # ‰ª£ÁêÜÈÖçÁΩÆ
        location / {
            proxy_pass http://rocketchat;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Nginx-Proxy true;
            
            proxy_redirect off;
            proxy_buffering off;
            proxy_cache_bypass $http_upgrade;
            
            # Ë∂ÖÊó∂ÈÖçÁΩÆ
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }
    }
}
```

**‚ö†Ô∏è ÈáçË¶ÅÔºö** ËØ∑Â∞ÜÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑ `chat.yourcompany.com` ÊõøÊç¢‰∏∫ÊÇ®ÁöÑÂÆûÈôÖÂüüÂêç„ÄÇ

## üîí Á¨¨‰∏ÉÊ≠•ÔºöËé∑Âèñ SSL ËØÅ‰π¶

### 7.1 ÂàõÂª∫ Certbot ÁΩëÁ´ôÊ†πÁõÆÂΩï

```bash
cd /opt/rocketchat
mkdir -p config/certbot-webroot
```

### 7.2 ‰∏¥Êó∂ÂêØÂä® NginxÔºàÁî®‰∫éËØÅ‰π¶È™åËØÅÔºâ

```bash
# ÂàõÂª∫‰∏¥Êó∂ Nginx ÈÖçÁΩÆÔºà‰ªÖÁî®‰∫éËé∑ÂèñËØÅ‰π¶Ôºâ
cat > config/nginx-temp.conf << 'EOF'
events {
    worker_connections 1024;
}

http {
    server {
        listen 80;
        server_name chat.yourcompany.com;
        
        location /.well-known/acme-challenge/ {
            root /var/www/certbot;
        }
        
        location / {
            return 200 'OK';
            add_header Content-Type text/plain;
        }
    }
}
EOF

# ÂêØÂä®‰∏¥Êó∂ Nginx
docker run -d --name temp-nginx \
  -p 80:80 \
  -v $(pwd)/config/nginx-temp.conf:/etc/nginx/nginx.conf:ro \
  -v $(pwd)/config/certbot-webroot:/var/www/certbot \
  nginx:alpine
```

### 7.3 Ëé∑Âèñ SSL ËØÅ‰π¶

```bash
# ËøêË°å Certbot Ëé∑ÂèñËØÅ‰π¶
docker run --rm \
  -v $(pwd)/ssl:/etc/letsencrypt \
  -v $(pwd)/config/certbot-webroot:/var/www/certbot \
  certbot/certbot certonly \
  --webroot \
  --webroot-path=/var/www/certbot \
  --email admin@yourcompany.com \
  --agree-tos \
  --no-eff-email \
  -d chat.yourcompany.com

# ÂÅúÊ≠¢‰∏¥Êó∂ Nginx
docker stop temp-nginx
docker rm temp-nginx
```

**‚ö†Ô∏è ÈáçË¶ÅÔºö** ËØ∑Â∞ÜÈÇÆÁÆ±ÂíåÂüüÂêçÊõøÊç¢‰∏∫ÊÇ®ÁöÑÂÆûÈôÖ‰ø°ÊÅØ„ÄÇ

### 7.4 È™åËØÅËØÅ‰π¶

```bash
# Ê£ÄÊü•ËØÅ‰π¶Êñá‰ª∂
ls -la ssl/live/chat.yourcompany.com/

# Â∫îËØ•ÁúãÂà∞‰ª•‰∏ãÊñá‰ª∂Ôºö
# cert.pem -> ../../archive/chat.yourcompany.com/cert1.pem
# chain.pem -> ../../archive/chat.yourcompany.com/chain1.pem
# fullchain.pem -> ../../archive/chat.yourcompany.com/fullchain1.pem
# privkey.pem -> ../../archive/chat.yourcompany.com/privkey1.pem
```

## üöÄ Á¨¨ÂÖ´Ê≠•ÔºöÂêØÂä®ÊúçÂä°

### 8.1 ÊãâÂèñÈïúÂÉè

```bash
cd /opt/rocketchat

# ÊãâÂèñÊâÄÈúÄÁöÑ Docker ÈïúÂÉè
docker-compose pull
```

### 8.2 ÂêØÂä®ÊúçÂä°

```bash
# ÂêØÂä®ÊâÄÊúâÊúçÂä°
docker-compose up -d

# Êü•ÁúãÊúçÂä°Áä∂ÊÄÅ
docker-compose ps

# Êü•ÁúãÊó•Âøó
docker-compose logs -f
```

### 8.3 È™åËØÅÊúçÂä°Áä∂ÊÄÅ

```bash
# Ê£ÄÊü•ÂÆπÂô®Áä∂ÊÄÅ
docker ps

# Ê£ÄÊü• Rocket.Chat ÂÅ•Â∫∑Áä∂ÊÄÅ
curl -f http://localhost:3000/api/info

# Ê£ÄÊü• MongoDB ËøûÊé•
docker exec rocketchat-mongo mongo --eval "db.adminCommand('ismaster')"
```

## üîß Á¨¨‰πùÊ≠•ÔºöÂàùÂßãÂåñÈÖçÁΩÆ

### 9.1 ËÆøÈóÆÂ∫îÁî®

1. ÊâìÂºÄÊµèËßàÂô®ÔºåËÆøÈóÆÔºö`https://chat.yourcompany.com`
2. Â¶ÇÊûúÁúãÂà∞ Rocket.Chat ÁôªÂΩïÈ°µÈù¢ÔºåËØ¥ÊòéÈÉ®ÁΩ≤ÊàêÂäü

### 9.2 ÂàõÂª∫ÁÆ°ÁêÜÂëòË¥¶Êà∑

1. È¶ñÊ¨°ËÆøÈóÆ‰ºöÁúãÂà∞ËÆæÁΩÆÂêëÂØº
2. ÊåâÁÖßÂêëÂØºÂàõÂª∫ÁÆ°ÁêÜÂëòË¥¶Êà∑
3. ÈÖçÁΩÆÁªÑÁªá‰ø°ÊÅØ
4. ÂÆåÊàêÂàùÂßãËÆæÁΩÆ

### 9.3 È™åËØÅÂìÅÁâåÂÆöÂà∂

1. ÁôªÂΩïÂêéÊ£ÄÊü•‰æßËæπÊ†èÂ∫ïÈÉ®ÊòØÂê¶ÊòæÁ§∫ "HT.Chat Ê¨¢ËøéÊÇ®ÔºÅ"
2. Á°ÆËÆ§ÂìÅÁâåÂÆöÂà∂Â∑≤ÁîüÊïà

## üìä Á¨¨ÂçÅÊ≠•ÔºöÁõëÊéßÂíåÁª¥Êä§

### 10.1 ËÆæÁΩÆÊó•ÂøóËΩÆËΩ¨

```bash
# ÂàõÂª∫ logrotate ÈÖçÁΩÆ
sudo nano /etc/logrotate.d/rocketchat
```

Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

```
/opt/rocketchat/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
    postrotate
        docker-compose -f /opt/rocketchat/docker-compose.yml restart rocketchat
    endscript
}
```

### 10.2 ËÆæÁΩÆËá™Âä®Â§á‰ªΩ

```bash
# ÂàõÂª∫Â§á‰ªΩËÑöÊú¨
nano /opt/rocketchat/backup.sh
```

Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

```bash
#!/bin/bash

# Â§á‰ªΩÈÖçÁΩÆ
BACKUP_DIR="/opt/rocketchat/backups"
DATE=$(date +"%Y%m%d_%H%M%S")
BACKUP_NAME="rocketchat_backup_$DATE"

# ÂàõÂª∫Â§á‰ªΩÁõÆÂΩï
mkdir -p "$BACKUP_DIR/$BACKUP_NAME"

# Â§á‰ªΩ MongoDB
docker exec rocketchat-mongo mongodump --out "/backups/$BACKUP_NAME/mongodb"

# Â§á‰ªΩ‰∏ä‰º†Êñá‰ª∂
cp -r /opt/rocketchat/data/uploads "$BACKUP_DIR/$BACKUP_NAME/"

# Â§á‰ªΩÈÖçÁΩÆÊñá‰ª∂
cp /opt/rocketchat/.env "$BACKUP_DIR/$BACKUP_NAME/"
cp /opt/rocketchat/docker-compose.yml "$BACKUP_DIR/$BACKUP_NAME/"
cp /opt/rocketchat/config/nginx.conf "$BACKUP_DIR/$BACKUP_NAME/"

# ÂéãÁº©Â§á‰ªΩ
cd "$BACKUP_DIR"
tar -czf "$BACKUP_NAME.tar.gz" "$BACKUP_NAME"
rm -rf "$BACKUP_NAME"

# Âà†Èô§ 30 Â§©ÂâçÁöÑÂ§á‰ªΩ
find "$BACKUP_DIR" -name "*.tar.gz" -mtime +30 -delete

echo "Â§á‰ªΩÂÆåÊàê: $BACKUP_NAME.tar.gz"
```

```bash
# Ê∑ªÂä†ÊâßË°åÊùÉÈôê
chmod +x /opt/rocketchat/backup.sh

# ËÆæÁΩÆÂÆöÊó∂‰ªªÂä°
crontab -e

# Ê∑ªÂä†‰ª•‰∏ãË°åÔºàÊØèÂ§©ÂáåÊô® 2 ÁÇπÂ§á‰ªΩÔºâ
0 2 * * * /opt/rocketchat/backup.sh >> /opt/rocketchat/logs/backup.log 2>&1
```

### 10.3 SSL ËØÅ‰π¶Ëá™Âä®Áª≠Êúü

```bash
# ÂàõÂª∫ËØÅ‰π¶Áª≠ÊúüËÑöÊú¨
nano /opt/rocketchat/renew-ssl.sh
```

Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

```bash
#!/bin/bash

cd /opt/rocketchat

# Áª≠ÊúüËØÅ‰π¶
docker run --rm \
  -v $(pwd)/ssl:/etc/letsencrypt \
  -v $(pwd)/config/certbot-webroot:/var/www/certbot \
  certbot/certbot renew

# ÈáçÂêØ Nginx
docker-compose restart nginx

echo "SSL ËØÅ‰π¶Áª≠ÊúüÊ£ÄÊü•ÂÆåÊàê"
```

```bash
# Ê∑ªÂä†ÊâßË°åÊùÉÈôê
chmod +x /opt/rocketchat/renew-ssl.sh

# ËÆæÁΩÆÂÆöÊó∂‰ªªÂä°ÔºàÊØèÊúà 1 Âè∑Ê£ÄÊü•Áª≠ÊúüÔºâ
crontab -e

# Ê∑ªÂä†‰ª•‰∏ãË°å
0 3 1 * * /opt/rocketchat/renew-ssl.sh >> /opt/rocketchat/logs/ssl-renew.log 2>&1
```

### 10.4 ÁõëÊéßËÑöÊú¨

```bash
# ÂàõÂª∫ÁõëÊéßËÑöÊú¨
nano /opt/rocketchat/monitor.sh
```

Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

```bash
#!/bin/bash

# Ê£ÄÊü•ÊúçÂä°Áä∂ÊÄÅ
check_service() {
    local service=$1
    local status=$(docker-compose ps -q $service | xargs docker inspect -f '{{.State.Status}}')
    
    if [ "$status" != "running" ]; then
        echo "[$(date)] Ë≠¶Âëä: $service ÊúçÂä°Êú™ËøêË°å" >> /opt/rocketchat/logs/monitor.log
        # ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÈÇÆ‰ª∂ÊàñÁü≠‰ø°ÈÄöÁü•
        docker-compose restart $service
    fi
}

# Ê£ÄÊü•Á£ÅÁõòÁ©∫Èó¥
check_disk_space() {
    local usage=$(df /opt/rocketchat | awk 'NR==2 {print $5}' | sed 's/%//')
    
    if [ $usage -gt 80 ]; then
        echo "[$(date)] Ë≠¶Âëä: Á£ÅÁõò‰ΩøÁî®ÁéáËææÂà∞ $usage%" >> /opt/rocketchat/logs/monitor.log
    fi
}

# Ê£ÄÊü•ÂÜÖÂ≠ò‰ΩøÁî®
check_memory() {
    local usage=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
    
    if [ $usage -gt 90 ]; then
        echo "[$(date)] Ë≠¶Âëä: ÂÜÖÂ≠ò‰ΩøÁî®ÁéáËææÂà∞ $usage%" >> /opt/rocketchat/logs/monitor.log
    fi
}

cd /opt/rocketchat

# ÊâßË°åÊ£ÄÊü•
check_service "rocketchat"
check_service "mongo"
check_service "nginx"
check_disk_space
check_memory

echo "[$(date)] ÁõëÊéßÊ£ÄÊü•ÂÆåÊàê" >> /opt/rocketchat/logs/monitor.log
```

```bash
# Ê∑ªÂä†ÊâßË°åÊùÉÈôê
chmod +x /opt/rocketchat/monitor.sh

# ËÆæÁΩÆÂÆöÊó∂‰ªªÂä°ÔºàÊØè 5 ÂàÜÈíüÊ£ÄÊü•‰∏ÄÊ¨°Ôºâ
crontab -e

# Ê∑ªÂä†‰ª•‰∏ãË°å
*/5 * * * * /opt/rocketchat/monitor.sh
```

## üîß Á¨¨ÂçÅ‰∏ÄÊ≠•ÔºöÂ∏∏Áî®ÁÆ°ÁêÜÂëΩ‰ª§

### 11.1 ÊúçÂä°ÁÆ°ÁêÜ

```bash
cd /opt/rocketchat

# Êü•ÁúãÊúçÂä°Áä∂ÊÄÅ
docker-compose ps

# ÂêØÂä®ÊâÄÊúâÊúçÂä°
docker-compose up -d

# ÂÅúÊ≠¢ÊâÄÊúâÊúçÂä°
docker-compose down

# ÈáçÂêØÁâπÂÆöÊúçÂä°
docker-compose restart rocketchat
docker-compose restart nginx
docker-compose restart mongo

# Êü•ÁúãÊó•Âøó
docker-compose logs -f rocketchat
docker-compose logs -f nginx
docker-compose logs -f mongo

# Êõ¥Êñ∞ÈïúÂÉè
docker-compose pull
docker-compose up -d
```

### 11.2 Êï∞ÊçÆÂ∫ìÁÆ°ÁêÜ

```bash
# ËøõÂÖ• MongoDB ÂÆπÂô®
docker exec -it rocketchat-mongo mongo

# Êü•ÁúãÊï∞ÊçÆÂ∫ì
show dbs
use rocketchat
show collections

# Â§á‰ªΩÊï∞ÊçÆÂ∫ì
docker exec rocketchat-mongo mongodump --out /backups/manual_backup

# ÊÅ¢Â§çÊï∞ÊçÆÂ∫ì
docker exec rocketchat-mongo mongorestore /backups/manual_backup
```

### 11.3 Êó•ÂøóÊü•Áúã

```bash
# Êü•ÁúãÂ∫îÁî®Êó•Âøó
tail -f /opt/rocketchat/logs/*.log

# Êü•Áúã Nginx Êó•Âøó
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# Êü•Áúã Docker ÂÆπÂô®Êó•Âøó
docker logs -f rocketchat-app
docker logs -f rocketchat-mongo
docker logs -f rocketchat-nginx
```

## üö® Á¨¨ÂçÅ‰∫åÊ≠•ÔºöÊïÖÈöúÊéíÈô§

### 12.1 Â∏∏ËßÅÈóÆÈ¢ò

#### ÈóÆÈ¢ò 1ÔºöÊó†Ê≥ïËÆøÈóÆÁΩëÁ´ô

```bash
# Ê£ÄÊü•ÊúçÂä°Áä∂ÊÄÅ
docker-compose ps

# Ê£ÄÊü•Á´ØÂè£Âç†Áî®
netstat -tlnp | grep :80
netstat -tlnp | grep :443

# Ê£ÄÊü•Èò≤ÁÅ´Â¢ô
sudo ufw status
sudo firewall-cmd --list-all

# Ê£ÄÊü• DNS Ëß£Êûê
nslookup chat.yourcompany.com
```

#### ÈóÆÈ¢ò 2ÔºöSSL ËØÅ‰π¶ÈóÆÈ¢ò

```bash
# Ê£ÄÊü•ËØÅ‰π¶Êñá‰ª∂
ls -la /opt/rocketchat/ssl/live/chat.yourcompany.com/

# ÊµãËØïËØÅ‰π¶
openssl x509 -in /opt/rocketchat/ssl/live/chat.yourcompany.com/cert.pem -text -noout

# ÈáçÊñ∞Ëé∑ÂèñËØÅ‰π¶
/opt/rocketchat/renew-ssl.sh
```

#### ÈóÆÈ¢ò 3ÔºöÊï∞ÊçÆÂ∫ìËøûÊé•ÈóÆÈ¢ò

```bash
# Ê£ÄÊü• MongoDB Áä∂ÊÄÅ
docker exec rocketchat-mongo mongo --eval "db.adminCommand('ismaster')"

# Ê£ÄÊü•ÂâØÊú¨ÈõÜÁä∂ÊÄÅ
docker exec rocketchat-mongo mongo --eval "rs.status()"

# ÈáçÊñ∞ÂàùÂßãÂåñÂâØÊú¨ÈõÜ
docker-compose restart mongo-init-replica
```

### 12.2 ÊÄßËÉΩ‰ºòÂåñ

#### ‰ºòÂåñ MongoDB

```bash
# ËøõÂÖ• MongoDB ÂÆπÂô®
docker exec -it rocketchat-mongo mongo

# ÂàõÂª∫Á¥¢Âºï
use rocketchat
db.rocketchat_message.createIndex({"rid": 1, "ts": 1})
db.users.createIndex({"username": 1})
db.users.createIndex({"emails.address": 1})
```

#### ‰ºòÂåñ Nginx

ÁºñËæë `/opt/rocketchat/config/nginx.conf`ÔºåÊ∑ªÂä†ÁºìÂ≠òÈÖçÁΩÆÔºö

```nginx
# Âú® http Âùó‰∏≠Ê∑ªÂä†
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=rocketchat_cache:10m max_size=1g inactive=60m use_temp_path=off;

# Âú® location / Âùó‰∏≠Ê∑ªÂä†
proxy_cache rocketchat_cache;
proxy_cache_valid 200 302 10m;
proxy_cache_valid 404 1m;
```

## üìã Á¨¨ÂçÅ‰∏âÊ≠•ÔºöÂÆâÂÖ®Âä†Âõ∫

### 13.1 Èò≤ÁÅ´Â¢ôÈÖçÁΩÆ

```bash
# Ubuntu/Debian (UFW)
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw deny 3000/tcp  # Á¶ÅÊ≠¢Áõ¥Êé•ËÆøÈóÆ Rocket.Chat Á´ØÂè£

# CentOS/RHEL (firewalld)
sudo systemctl enable firewalld
sudo systemctl start firewalld
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 13.2 Á≥ªÁªüÂÆâÂÖ®Êõ¥Êñ∞

```bash
# ÂàõÂª∫Ëá™Âä®Êõ¥Êñ∞ËÑöÊú¨
nano /opt/rocketchat/security-update.sh
```

Ê∑ªÂä†‰ª•‰∏ãÂÜÖÂÆπÔºö

```bash
#!/bin/bash

# Êõ¥Êñ∞Á≥ªÁªüÂåÖ
apt update && apt upgrade -y

# Êõ¥Êñ∞ Docker ÈïúÂÉè
cd /opt/rocketchat
docker-compose pull
docker-compose up -d

# Ê∏ÖÁêÜÊóßÈïúÂÉè
docker image prune -f

echo "[$(date)] ÂÆâÂÖ®Êõ¥Êñ∞ÂÆåÊàê" >> /opt/rocketchat/logs/security-update.log
```

```bash
# Ê∑ªÂä†ÊâßË°åÊùÉÈôê
chmod +x /opt/rocketchat/security-update.sh

# ËÆæÁΩÆÂÆöÊó∂‰ªªÂä°ÔºàÊØèÂë®Êó•ÂáåÊô® 4 ÁÇπÔºâ
crontab -e

# Ê∑ªÂä†‰ª•‰∏ãË°å
0 4 * * 0 /opt/rocketchat/security-update.sh
```

## üéâ ÈÉ®ÁΩ≤ÂÆåÊàê

ÊÅ≠ÂñúÔºÅÊÇ®Â∑≤ÁªèÊàêÂäüÂÆåÊàê‰∫Ü Rocket.Chat ÁöÑÁîü‰∫ßÁéØÂ¢ÉÈÉ®ÁΩ≤„ÄÇÁé∞Âú®ÊÇ®ÂèØ‰ª•Ôºö

1. **ËÆøÈóÆÂ∫îÁî®**Ôºöhttps://chat.yourcompany.com
2. **ÁÆ°ÁêÜÂêéÂè∞**Ôºöhttps://chat.yourcompany.com/admin
3. **ÁõëÊéßÊó•Âøó**Ôºö`/opt/rocketchat/logs/`
4. **Êü•ÁúãÂ§á‰ªΩ**Ôºö`/opt/rocketchat/backups/`

## üìû ÊäÄÊúØÊîØÊåÅ

Â¶ÇÊûúÂú®ÈÉ®ÁΩ≤ËøáÁ®ã‰∏≠ÈÅáÂà∞ÈóÆÈ¢òÔºåËØ∑Ê£ÄÊü•Ôºö

1. **Êó•ÂøóÊñá‰ª∂**Ôºö`/opt/rocketchat/logs/`
2. **Docker Êó•Âøó**Ôºö`docker-compose logs`
3. **Á≥ªÁªüÊó•Âøó**Ôºö`journalctl -u docker`
4. **ÁΩëÁªúËøûÊé•**ÔºöÁ°Æ‰øùÂüüÂêçËß£ÊûêÊ≠£Á°Æ
5. **Èò≤ÁÅ´Â¢ôËÆæÁΩÆ**ÔºöÁ°Æ‰øùÁ´ØÂè£ 80 Âíå 443 ÂºÄÊîæ

## üìö Áõ∏ÂÖ≥ÊñáÊ°£

- [Rocket.Chat ÂÆòÊñπÊñáÊ°£](https://docs.rocket.chat/)
- [Docker Compose ÊñáÊ°£](https://docs.docker.com/compose/)
- [Nginx ÈÖçÁΩÆÊåáÂçó](https://nginx.org/en/docs/)
- [Let's Encrypt ÊñáÊ°£](https://letsencrypt.org/docs/)
- [MongoDB ÊñáÊ°£](https://docs.mongodb.com/)

---

**üîí ÂÆâÂÖ®ÊèêÈÜí**Ôºö
- ÂÆöÊúüÊõ¥Êñ∞Á≥ªÁªüÂíåÂ∫îÁî®
- ‰ΩøÁî®Âº∫ÂØÜÁ†Å
- ÂÆöÊúüÂ§á‰ªΩÊï∞ÊçÆ
- ÁõëÊéßÁ≥ªÁªüÊó•Âøó
- ÂèäÊó∂Â∫îÁî®ÂÆâÂÖ®Ë°•‰∏Å

**üìà ÊÄßËÉΩÂª∫ËÆÆ**Ôºö
- Ê†πÊçÆÁî®Êà∑Êï∞ÈáèË∞ÉÊï¥ÊúçÂä°Âô®ÈÖçÁΩÆ
- ÂÆöÊúüÊ∏ÖÁêÜÊó•ÂøóÊñá‰ª∂
- ÁõëÊéßËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ
- ËÄÉËôë‰ΩøÁî® CDN Âä†ÈÄüÈùôÊÄÅËµÑÊ∫ê

Á•ùÊÇ®‰ΩøÁî®ÊÑâÂø´ÔºÅüöÄ